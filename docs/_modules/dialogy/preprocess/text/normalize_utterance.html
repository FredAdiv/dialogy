<!DOCTYPE html>
<html >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
      <title>dialogy.preprocess.text.normalize_utterance</title>
    
      <link rel="stylesheet" href="../../../../_static/pygments.css">
      <link rel="stylesheet" href="../../../../_static/theme.css">
      <link rel="stylesheet" href="../../../../_static/sphinx_press_theme.css">
      
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>

      <!-- sphinx script_files -->
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>

      
      <script src="../../../../_static/theme-vendors.js"></script>
      <script src="../../../../_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="../../../../genindex.html" />
  <link rel="search" title="Search" href="../../../../search.html" /> 
  </head>

  <body>
    <div id="app" class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="../../../../index.html" class="home-link">
    
      <span class="site-name">dialogy</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="../../../../search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../../../source/modules.html#dialogy">dialogy</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../../../../source/dialogy.html" class="reference internal ">dialogy package</a>

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../../../../index.html">Docs</a> &raquo;</li>
    
      <li><a href="../../../index.html">Module code</a> &raquo;</li>
    
    <li>dialogy.preprocess.text.normalize_utterance</li>
  </ul>
  

  <ul class="page-nav">
</ul>
  
</div>
<hr>
          <div class="content" role="main">
            
  <h1>Source code for dialogy.preprocess.text.normalize_utterance</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module was created in response to: https://github.com/Vernacular-ai/dialogy/issues/9</span>
<span class="sd">we will ship functions to assist normalization of ASR output, we will refer to these as Utterances.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">dialogy</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">const</span>


<div class="viewcode-block" id="dict_get"><a class="viewcode-back" href="../../../../source/dialogy.preprocess.text.html#dialogy.preprocess.text.normalize_utterance.dict_get">[docs]</a><span class="k">def</span> <span class="nf">dict_get</span><span class="p">(</span><span class="n">prop</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get value of prop within obj.</span>

<span class="sd">    This simple function exists to facilitate a partial function defined :ref:`here&lt;is_utterance&gt;`.</span>

<span class="sd">    :param prop: A property within a :code:`dict`.</span>
<span class="sd">    :type prop: str</span>
<span class="sd">    :param obj: A :code:`dict`.</span>
<span class="sd">    :type obj: Dict[str, Any]</span>
<span class="sd">    :return: Value of a property within a :code:`dict`.</span>
<span class="sd">    :rtype: Any</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">obj</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span></div>


<div class="viewcode-block" id="is_list"><a class="viewcode-back" href="../../../../source/dialogy.preprocess.text.html#dialogy.preprocess.text.normalize_utterance.is_list">[docs]</a><span class="k">def</span> <span class="nf">is_list</span><span class="p">(</span><span class="n">input_</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check type of `input_`</span>

<span class="sd">    :param input_: Any arbitrary input</span>
<span class="sd">    :type input_: Any</span>
<span class="sd">    :return: True if input_ is a :code:`list` else False</span>
<span class="sd">    :rtype: True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span></div>


<div class="viewcode-block" id="is_each_element"><a class="viewcode-back" href="../../../../source/dialogy.preprocess.text.html#dialogy.preprocess.text.normalize_utterance.is_each_element">[docs]</a><span class="k">def</span> <span class="nf">is_each_element</span><span class="p">(</span>
    <span class="n">type_</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span> <span class="n">input_</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">transform</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if each element in a list is of a given type.</span>

<span class="sd">    .. ipython:: python</span>

<span class="sd">        from dialogy.preprocess.text.normalize_utterance import is_each_element</span>

<span class="sd">        is_each_element(str, [&quot;this&quot;, &quot;returns&quot;, &quot;False&quot;, &quot;cuz:&quot;, False])</span>
<span class="sd">        is_each_element(str, [&quot;this&quot;, &quot;returns&quot;, &quot;True&quot;, &quot;cuz:&quot;, &quot;all&quot;, &quot;str&quot;])</span>

<span class="sd">    :param type_: Expected :code:`Type` of each element in the :code:`input_` which is a :code:`list`.</span>
<span class="sd">    :type type_: Type</span>
<span class="sd">    :param input_: A :code:`list`.</span>
<span class="sd">    :type input_: List[Any]</span>
<span class="sd">    :param transform: We may apply some transforms to</span>
<span class="sd">        each element before making these checks. This is to check if a certain key</span>
<span class="sd">        in a Dict matches the expected type. In case this is not needed,</span>
<span class="sd">        leave the argument unset and an identity transform is applied. Defaults to lambda x:x.</span>
<span class="sd">    :type transform: Callable[[Any], Any]</span>
<span class="sd">    :return: Checks each element in a list to match :code:`type_`, if any element fails the check,</span>
<span class="sd">        this returns False, else True.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">transform</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="n">type_</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">input_</span><span class="p">)</span></div>


<div class="viewcode-block" id="is_utterance"><a class="viewcode-back" href="../../../../source/dialogy.preprocess.text.html#dialogy.preprocess.text.normalize_utterance.is_utterance">[docs]</a><span class="k">def</span> <span class="nf">is_utterance</span><span class="p">(</span><span class="n">maybe_utterance</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">TRANSCRIPT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. _is_utterance:</span>
<span class="sd">    Check input to be of `List[List[Dict]]`.</span>

<span class="sd">    ```json</span>
<span class="sd">    [[{&quot;transcript&quot;: &quot;hi&quot;}]]</span>
<span class="sd">    ```</span>

<span class="sd">    .. ipython:: python</span>

<span class="sd">        from dialogy.preprocess.text.normalize_utterance import is_utterance</span>

<span class="sd">        # 1. :code:`List[List[Dict[str, str]]]`</span>
<span class="sd">        is_utterance([[{&quot;transcript&quot;: &quot;this&quot;}, {&quot;transcript&quot;: &quot;works&quot;}]])</span>

<span class="sd">        # 2. key is configurable</span>
<span class="sd">        is_utterance([[{&quot;text&quot;: &quot;this&quot;}, {&quot;text&quot;: &quot;works&quot;}]], key=&quot;text&quot;)</span>

<span class="sd">        # 3. Hope for everything else... you have a mastercard.</span>
<span class="sd">        # Or use this lib, works just fine 🍷.</span>
<span class="sd">        is_utterance([{&quot;transcript&quot;: &quot;this&quot;}, {&quot;transcript&quot;: &quot;doesn&#39;t&quot;}, {&quot;transcript&quot;: &quot;work&quot;}])</span>

<span class="sd">    :param maybe_utterance: Arbitrary input.</span>
<span class="sd">    :type maybe_utterance: Any</span>
<span class="sd">    :param key: The key within which transcription string resides.</span>
<span class="sd">            Defaults to :code:`const.TRANSCRIPT`.</span>
<span class="sd">    :type key: str</span>
<span class="sd">    :return: True if the inputs is :code:`List[List[Dict[str, str]]]`, else False.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dict_get_key</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">dict_get</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">is_each_element</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">alternatives</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">dict_get_key</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">alternatives</span> <span class="ow">in</span> <span class="n">maybe_utterance</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="is_unsqueezed_utterance"><a class="viewcode-back" href="../../../../source/dialogy.preprocess.text.html#dialogy.preprocess.text.normalize_utterance.is_unsqueezed_utterance">[docs]</a><span class="k">def</span> <span class="nf">is_unsqueezed_utterance</span><span class="p">(</span><span class="n">maybe_utterance</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">TRANSCRIPT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check input to be of `List[Dict]`.</span>

<span class="sd">    .. ipython:: python</span>

<span class="sd">        from dialogy.preprocess.text.normalize_utterance import is_unsqueezed_utterance</span>

<span class="sd">        # 1. This fails</span>
<span class="sd">        is_unsqueezed_utterance([[{&quot;transcript&quot;: &quot;this&quot;}, {&quot;transcript&quot;: &quot;works&quot;}]])</span>

<span class="sd">        # 2. key is configurable</span>
<span class="sd">        is_unsqueezed_utterance([{&quot;text&quot;: &quot;this&quot;}, {&quot;text&quot;: &quot;works&quot;}], key=&quot;text&quot;)</span>

<span class="sd">    :param maybe_utterance: Arbitrary type input.</span>
<span class="sd">    :type maybe_utterance: Any</span>
<span class="sd">    :param key: The key within which transcription string resides.</span>
<span class="sd">    :type key: str, Defaults to const.TRANSCRIPT.</span>
<span class="sd">    :return: True, if the input is of type :code:`List[Dict[str, Any]]` else False.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dict_get_key</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">dict_get</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">is_each_element</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">maybe_utterance</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">dict_get_key</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="is_list_of_string"><a class="viewcode-back" href="../../../../source/dialogy.preprocess.text.html#dialogy.preprocess.text.normalize_utterance.is_list_of_string">[docs]</a><span class="k">def</span> <span class="nf">is_list_of_string</span><span class="p">(</span><span class="n">maybe_utterance</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check input to be of `List[str]`.</span>

<span class="sd">    .. ipython:: python</span>

<span class="sd">        from dialogy.preprocess.text.normalize_utterance import is_list_of_string</span>
<span class="sd">        is_list_of_string([&quot;this&quot;, &quot;works&quot;])</span>

<span class="sd">    :param maybe_utterance: Arbitrary input.</span>
<span class="sd">    :type maybe_utterance: Any</span>
<span class="sd">    :return: True if :code:`maybe_utterance` is a :code:`str`.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">is_each_element</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">maybe_utterance</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="is_string"><a class="viewcode-back" href="../../../../source/dialogy.preprocess.text.html#dialogy.preprocess.text.normalize_utterance.is_string">[docs]</a><span class="k">def</span> <span class="nf">is_string</span><span class="p">(</span><span class="n">maybe_utterance</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check input&#39;s type is `str`.</span>

<span class="sd">    :param maybe_utterance: Arbitrary type input.</span>
<span class="sd">    :type maybe_utterance: Any</span>
<span class="sd">    :return: True if :code:`maybe_utterance` is a :code:`str`, else False.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maybe_utterance</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span></div>


<div class="viewcode-block" id="normalize"><a class="viewcode-back" href="../../../../source/dialogy.preprocess.text.html#dialogy.preprocess.text.normalize_utterance.normalize">[docs]</a><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">maybe_utterance</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">TRANSCRIPT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adapt various non-standard ASR alternative forms.</span>

<span class="sd">    The output will be a list of strings since models will expect that.</span>


<span class="sd">    .. ipython:: python</span>

<span class="sd">        from dialogy.preprocess import normalize</span>

<span class="sd">        normalize([[{&quot;transcript&quot;: &quot;hi&quot;}]])</span>
<span class="sd">        normalize([[{&quot;transcript&quot;: &quot;hello&quot;}], [{&quot;transcript&quot;: &quot;world&quot;}]])</span>
<span class="sd">        normalize([{&quot;transcript&quot;: &quot;I wanted to know umm hello?&quot;}])</span>
<span class="sd">        normalize([&quot;I wanted to know umm hello?&quot;])</span>
<span class="sd">        normalize(&quot;I wanted to know umm hello?&quot;)</span>


<span class="sd">    :param maybe_utterance: Arbitrary input.</span>
<span class="sd">    :type maybe_utterance: Any</span>
<span class="sd">    :param key: A string to be looked into :code:`List[List[Dict[str, str]]]`, :code:`List[Dict[str, str]]` type inputs.</span>
<span class="sd">    :type key: str</span>
<span class="sd">    :return: A flattened list of strings parsed from various formats.</span>
<span class="sd">    :rtype: List[str]</span>
<span class="sd">    :raises:</span>
<span class="sd">        TypeError: If :code:`maybe_utterance` is none of the expected types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_utterance</span><span class="p">(</span><span class="n">maybe_utterance</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">alternative</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">alternatives</span> <span class="ow">in</span> <span class="n">maybe_utterance</span>
            <span class="k">for</span> <span class="n">alternative</span> <span class="ow">in</span> <span class="n">alternatives</span>
        <span class="p">]</span>

    <span class="k">if</span> <span class="n">is_unsqueezed_utterance</span><span class="p">(</span><span class="n">maybe_utterance</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">alternative</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">alternative</span> <span class="ow">in</span> <span class="n">maybe_utterance</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">is_list</span><span class="p">(</span><span class="n">maybe_utterance</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_list_of_string</span><span class="p">(</span><span class="n">maybe_utterance</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maybe_utterance</span>

    <span class="k">if</span> <span class="n">is_string</span><span class="p">(</span><span class="n">maybe_utterance</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">maybe_utterance</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The input </span><span class="si">{</span><span class="n">maybe_utterance</span><span class="si">}</span><span class="s2"> does not belong to any of the expected types:&quot;</span>
            <span class="s2">&quot; List[List[Dict[str, Any]]], List[Dict[str, Any]], List[str] or str.&quot;</span>
        <span class="p">)</span></div>
</pre></div>

          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
</ul><div class="footer" role="contentinfo">
      &#169; Copyright .
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.3 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a>.
</div>
            </div>
          </div>
      </page>
    </div>
    
    
  </body>
</html>